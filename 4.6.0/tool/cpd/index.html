
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Gradle quality plugin for Java and Groovy">
      
      
      
        <meta name="author" content="Vyacheslav Rusakov">
      
      
        <link rel="canonical" href="https://xvik.github.io/gradle-quality-plugin/4.6.0/tool/cpd/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.6">
    
    
      
        <title>CPD - Gradle quality plugin</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2c0c5eaf.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cpd-copypaste-detector" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Gradle quality plugin" class="md-header__button md-logo" aria-label="Gradle quality plugin" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gradle quality plugin
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CPD
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="http://github.com/xvik/gradle-quality-plugin/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gradle-quality-plugin
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Gradle quality plugin" class="md-nav__button md-logo" aria-label="Gradle quality plugin" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Gradle quality plugin
  </label>
  
    <div class="md-nav__source">
      
<a href="http://github.com/xvik/gradle-quality-plugin/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gradle-quality-plugin
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        User guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          User guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/automatic/" class="md-nav__link">
        Automatic mode
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/config/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/exclusion/" class="md-nav__link">
        Exclusion
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/profile/" class="md-nav__link">
        Profile
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Tools
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tools" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lint/" class="md-nav__link">
        Javac lint
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../checkstyle/" class="md-nav__link">
        Checkstyle
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pmd/" class="md-nav__link">
        PMD
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          CPD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        CPD
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    Output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    Config
  </a>
  
    <nav class="md-nav" aria-label="Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpd-tasks" class="md-nav__link">
    Cpd tasks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-file-types-support" class="md-nav__link">
    Multiple file types support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-module-projects" class="md-nav__link">
    Multi-module projects
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suppress" class="md-nav__link">
    Suppress
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../spotbugs/" class="md-nav__link">
        SpotBugs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../codenarc/" class="md-nav__link">
        CodeNarc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../animalsniffer/" class="md-nav__link">
        Animalsniffer
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Tasks
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tasks" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tasks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../task/config/" class="md-nav__link">
        Copy config
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../task/group/" class="md-nav__link">
        Group
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        About
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/history/" class="md-nav__link">
        Release notes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/compatibility/" class="md-nav__link">
        Compatibility
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        License
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    Output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    Config
  </a>
  
    <nav class="md-nav" aria-label="Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpd-tasks" class="md-nav__link">
    Cpd tasks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-file-types-support" class="md-nav__link">
    Multiple file types support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-module-projects" class="md-nav__link">
    Multi-module projects
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suppress" class="md-nav__link">
    Suppress
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="http://github.com/xvik/gradle-quality-plugin/edit/master/src/doc/docs/tool/cpd.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="cpd-copypaste-detector">CPD (Copy/Paste Detector)<a class="headerlink" href="#cpd-copypaste-detector" title="Permanent link">&para;</a></h1>
<div class="admonition summary">
<p>Java by default, suitable for anything (groovy, jsp, simple text etc.) | 
<a href="https://pmd.github.io/latest/pmd_userdocs_cpd.html">Home</a> |
<a href="https://github.com/aaschmid/gradle-cpd-plugin">Plugin</a>   </p>
</div>
<p>CPD support activates only when <a href="https://github.com/aaschmid/gradle-cpd-plugin">de.aaschmid.cpd</a> 
gradle plugin applied manually:</p>
<div class="highlight"><pre><span></span><code><span class="n">plugins</span> <span class="o">{</span>        
    <span class="n">id</span> <span class="s1">&#39;de.aaschmid.cpd&#39;</span> <span class="n">version</span> <span class="s1">&#39;3.2&#39;</span>
    <span class="n">id</span> <span class="s1">&#39;ru.vyarus.quality&#39;</span> <span class="n">version</span> <span class="s1">&#39;4.6.0&#39;</span>
<span class="o">}</span>
</code></pre></div>
<p>CPD is a part of <a href="../pmd/">PMD</a> project and so there is no need for additional version configuration (pmd version used). </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Special <a href="https://github.com/xvik/gradle-quality-plugin/blob/master/src/main/resources/ru/vyarus/quality/config/cpd/cpdhtml.xslt">xsl file</a> 
used for manual html report generation because plugin does not support html report. This is <a href="https://github.com/pmd/pmd/blob/master/pmd-core/etc/xslt/cpdhtml.xslt">official pmd style</a>,
but modified to show all duplicates (original script shows only duplicates &gt; 30 lines).</p>
</div>
<h2 id="output">Output<a class="headerlink" href="#output" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>2 java duplicates were found by CPD

sample.cpd.(OtherStruct1.java:3)  [16 lines / 75 tokens]
sample.cpd.(OtherStruct2.java:3)
  │
 3│    public class OtherStruct1 {
 4│    
 5│        public static void main(String[] args) {
 6│            Math.sqrt(12);
 7│            Math.sqrt(12);
 8│            Math.sqrt(12);
 9│            Math.sqrt(12);
10│            Math.sqrt(12);
11│            Math.sqrt(12);
12│            Math.sqrt(12);
13│            Math.sqrt(12);
14│            Math.sqrt(12);
15│            Math.sqrt(12);
16│        }
17│    
18│        public void differentMethod1() {
</code></pre></div>
<p>Shows all files with duplicate parts and source sample from the first file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Order of files may vary on different environments and so you may see sources from different files
in the resulted report. It doesn't matter much, just don't be surprised. </p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Tool does not search for exact matches, instead it tries to find very common blocks:
for example, some code block could be copied and slightly modified and cpd will be able to match it.</p>
</div>
<h2 id="config">Config<a class="headerlink" href="#config" title="Permanent link">&para;</a></h2>
<p>Config options with defaults:</p>
<div class="highlight"><pre><span></span><code><span class="n">quality</span> <span class="o">{</span>
    <span class="n">cpd</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// false to disable plugin configuration</span>
    <span class="n">cpdUnifySources</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// false to not modify cpdCheck task sources</span>
<span class="o">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CPD itself may be configured with plugin's <a href="https://github.com/aaschmid/gradle-cpd-plugin#options"><code>cpd</code> closure</a></p>
</div>
<p>Configurations applied by plugin:</p>
<div class="highlight"><pre><span></span><code><span class="n">cpd</span> <span class="o">{</span>
    <span class="n">toolVersion</span> <span class="o">=</span> <span class="n">quality</span><span class="o">.</span><span class="na">pmdVersion</span>
    <span class="n">ignoreFailures</span> <span class="o">=</span> <span class="o">!</span><span class="n">extension</span><span class="o">.</span><span class="na">strict</span>
<span class="o">}</span>
</code></pre></div>
<p>If only groovy sources available, then <code>cpd.language</code> automatically set to <code>groovy</code>
(but only if cpd task declared in the same module with quality plugin!). </p>
<h3 id="cpd-tasks">Cpd tasks<a class="headerlink" href="#cpd-tasks" title="Permanent link">&para;</a></h3>
<p>In contrast to other quality tools CPD plugin registers only one task <code>cpdCheck</code> instead of task per source set
(otherwise it would be impossible to find duplicates between source sets or even between different modules).</p>
<p>By default, <code>cpdCheck</code> task configured to check all available source sets. But quality plugin will
modify <code>chpdCheck.source</code>:</p>
<ul>
<li>All files from source sets, not configured for quality checks (<code>quality.sourceSets</code>) are removed.
This way cpd scope is unified with other quality plugins scope. </li>
<li>Global <a href="../../guide/exclusion/">excludes</a> are also applied. </li>
</ul>
<p>Source modifications could be disabled with <code>quality.cpdUnifySources = false</code> </p>
<p>If multiple cpd tasks would be registered (other tasks declared manually), sources would be modified only
for default <code>cpdCheck</code> task. But console reporting and HTML report will be added for all tasks.
Also, all cpd tasks would be disabled with <code>quality.enabled = false</code>    </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, CPD configured for java sources check. To change target language use:</p>
<div class="highlight"><pre><span></span><code><span class="n">cpd</span> <span class="o">{</span>
    <span class="n">language</span> <span class="o">=</span> <span class="s1">&#39;groovy&#39;</span>
<span class="o">}</span>
</code></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>CPD will try to check all files in enabled source sets. For example, if you have
both java and groovy sources in main source set then CPD will try to check both
and, most likely, will fail with groovy parse error (as language is java by default).</p>
<p>To solve such cases either manually exclude additional sources:
<div class="highlight"><pre><span></span><code><span class="n">cpdCheck</span><span class="p">.</span><span class="na">exclude</span> <span class="err">&#39;</span><span class="o">*</span><span class="p">.</span><span class="na">groovy</span><span class="err">&#39;</span>
</code></pre></div>
Or split check in multiple tasks, where each task checks only one language (see below),           </p>
</div>
<h3 id="multiple-file-types-support">Multiple file types support<a class="headerlink" href="#multiple-file-types-support" title="Permanent link">&para;</a></h3>
<p>If you need to check more than one type of files (for example, java and groovy sources), you'll
need to configure separate tasks per each required type. For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">cpdCheck</span><span class="o">.</span><span class="na">exclude</span> <span class="s1">&#39;*.groovy&#39;</span>                     

<span class="n">task</span> <span class="nf">groovyCpdCheck</span><span class="o">(</span><span class="nl">type:</span><span class="n">de</span><span class="o">.</span><span class="na">aaschmid</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">plugins</span><span class="o">.</span><span class="na">cpd</span><span class="o">.</span><span class="na">Cpd</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">language</span> <span class="o">=</span> <span class="s1">&#39;groovy&#39;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">allGroovy</span> 
<span class="o">}</span>
</code></pre></div>
<p>Here groovy sources excluded from default <code>cpdCheck</code> task (because cpd plugin by default covers all source sets).
Now the default task will search duplicates only in java files (and only within sources configured in quality plugin).</p>
<p>New task declared for searching groovy duplicates (groovyCpdCheck).</p>
<p>Both tasks will be assigned to <code>check</code>, so by calling <code>gradlew check</code> you'll run both checks.
Console report will be shown for both tasks (and HTML reports generated).</p>
<p>Note that task language will be also mentioned in console report:</p>
<div class="highlight"><pre><span></span><code>:check
:cpdCheck
2 java duplicates were found by CPD
...

:groovyCpdCheck
2 groovy duplicates were found by CPD
...
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>CPD understands <a href="https://pmd.github.io/latest/pmd_userdocs_cpd.html#supported-languages">many source languages</a>.
But if specified language cannot be found, a fallback mechanism uses <code>net.sourceforge.pmd.cpd.AnyLanguage</code> instead. 
This fallback language does not run ANTLR and therefore also checks duplicates in comments.</p>
<p>This way you can use cpd for searching for duplicates even in pure text files, web templates or other resources.</p>
</div>
<h3 id="multi-module-projects">Multi-module projects<a class="headerlink" href="#multi-module-projects" title="Permanent link">&para;</a></h3>
<p>For multi-module projects, it is <a href="https://github.com/aaschmid/gradle-cpd-plugin#multi-module-project">recommended</a> 
to apply cpd plugin in the root project. This way only one <code>cpdCheck</code> task is created (in the root project), which will
check sources from all modules (it's the only way to find duplicates between different modules).</p>
<p>But quality plugin, should be applied on module level (because all other quality tasks are source set scoped).</p>
<p>Expected root project configuration looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">plugins</span> <span class="o">{</span>
    <span class="n">id</span> <span class="s1">&#39;de.aaschmid.cpd&#39;</span> <span class="n">version</span> <span class="s1">&#39;3.1&#39;</span>
    <span class="n">id</span> <span class="s1">&#39;ru.vyarus.quality&#39;</span> <span class="n">version</span> <span class="s1">&#39;4.5.0&#39;</span> <span class="n">apply</span> <span class="kc">false</span>
<span class="o">}</span>
<span class="n">cpd</span> <span class="o">{</span>
    <span class="c1">// cpd configuration, if required</span>
<span class="o">}</span>

<span class="c1">// possibly other cpd tasks </span>

<span class="n">subprojects</span> <span class="o">{</span>
    <span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;java&#39;</span>
    <span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;ru.vyarus.quality&#39;</span>

    <span class="n">quality</span> <span class="o">{</span>
        <span class="c1">// plugin configuration, if required    </span>
    <span class="o">}</span>   
<span class="o">}</span>
</code></pre></div>
<p>This way each module have its own quality plugin, but quality configuration is the same in all modules.</p>
<p>Quality plugin will detect cpd plugin in the root project and configure it the same way as
in single module case. But as quality plugin will apply in each module, only first configured module
will apply <code>cpd</code> modifications of <code>toolVersion</code> and <code>ignoreFailures</code> (assuming this settings are the same for all modules).</p>
<p>Each module will exclude <code>cpdCheck</code> task sources, not covered by quality plugin configuration.
For example, if only main source set configured, each module will exclude test sources.
This way, each module control sources only related to its module and overall <code>cpdCheck</code> sources
configuration would be correct.</p>
<p>Each module will attach all root project's cpd tasks to its check (sub module's <code>check</code> depend on root project tasks).
Imagine if you work in one module you may call <code>check</code> only on module level. With common
quality tasks its clear - all configured module's source sets must be validated.
But you may introduce duplicates (e.g. copied method from other module) and the only
way to detect it is to call root project tasks (so its completely logical to assign root cpd check
to module checks).  </p>
<p>As an example, suppose we have 2 modules <code>mod1</code> and <code>mod2</code> with root project configuration as described above:</p>
<ul>
<li>root project's cpd plugin will be configured</li>
<li><code>mod1</code> will exclude <code>mod1/src/test/java</code> from <code>crpCheck.sources</code></li>
<li><code>:mod1:check</code> depends on <code>:cpdCheck</code></li>
<li><code>mod2</code> will exclude <code>mod2/src/test/java</code> from <code>crpCheck.sources</code></li>
<li><code>:mod2:check</code> depends on <code>:cpdCheck</code> </li>
</ul>
<p>You will also notice, that in the multi-module setup console output will identify class module:</p>
<div class="highlight"><pre><span></span><code>mod1/sample.cpd.(OtherStruct1.java:3)  [16 lines / 75 tokens]
mod2/sample.cpd.(OtherStruct2.java:3)
  │
 3│    public class OtherStruct1 {
 4│    
 5│        public static void main(String[] args) {
 6│            Math.sqrt(12);
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Quality plugin actually search CPD plugin not in the root-most project but in entire
parent chain. So if you have complex gradle project and cpd plugin declared somewhere
in the middle of projects hierarchy, everything will still be properly configured.  </p>
</div>
<h2 id="suppress">Suppress<a class="headerlink" href="#suppress" title="Permanent link">&para;</a></h2>
<p>CPD violations could be <a href="https://pmd.github.io/latest/pmd_userdocs_cpd.html#suppression">suppressed</a>
only for some languages (Java, C/C++, Dart, Go, Javascript, Kotlin, Lua, Matlab, Objective-C, PL/SQL, Python and Swift)
with comments containing CPD-OFF and CPD-ON:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="n">Object</span> <span class="nf">someParameterizedFactoryMethod</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="c1">// some unignored code</span>

    <span class="c1">// tell cpd to start ignoring code - CPD-OFF</span>

    <span class="c1">// mission critical code, manually loop unroll</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

    <span class="c1">// resume CPD analysis - CPD-ON</span>

    <span class="c1">// further code will *not* be ignored</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Java</strong> sources could be also suppressed with annotations:</p>
<div class="highlight"><pre><span></span><code><span class="c1">//enable suppression</span>
<span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&quot;CPD-START&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">Object</span> <span class="nf">someParameterizedFactoryMethod</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="c1">// any code here will be ignored for the duplication detection</span>
<span class="p">}</span>

<span class="c1">//disable suppression</span>
<span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&quot;CPD-END)</span>
<span class="s">public void nextMethod() {</span>
<span class="s">}</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../pmd/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              PMD
            </div>
          </div>
        </a>
      
      
        <a href="../spotbugs/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              SpotBugs
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2015-2021 Vyacheslav Rusakov
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/xvik" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/vyarus" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1c7c35e.min.js"></script>
      
    
  </body>
</html>